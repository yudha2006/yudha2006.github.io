<!DOCTYPE html>
<html>
  <head>
    <%- include('partials/header') %>
  </head>
  <body>
    <div class="container">
      <h1>Cashier System</h1>

      <!-- Form Input Transaksi -->
      <form action="/add-transaction" method="POST">
        <label for="buyerName">Nama Pembeli:</label>
        <input type="text" id="buyerName" name="buyerName" required />

        <h2>Daftar Barang</h2>
        <div id="items">
          <div class="item">
            <input
              type="text"
              name="itemName"
              placeholder="Nama Barang"
              required
            />
            <input
              type="number"
              name="itemPrice"
              placeholder="Harga"
              step="0.01"
              required
            />
            <input
              type="number"
              name="itemQuantity"
              placeholder="Jumlah"
              required
            />
          </div>
        </div>
        <button type="button" onclick="addItem()">Tambah Barang</button>

        <!-- Input tersembunyi untuk mengirim data barang -->
        <input type="hidden" name="items" id="itemsInput" />

        <button type="submit">Simpan Transaksi</button>
      </form>

      <!-- Daftar Transaksi -->
      <h2>Daftar Transaksi</h2>
      <table>
        <thead>
          <tr>
            <th>Nama Pembeli</th>
            <th>Barang</th>
            <th>Total</th>
            <th>Tanggal</th>
          </tr>
        </thead>
        <tbody>
          <% transactions.forEach(transaction => { %>
          <tr>
            <td><%= transaction.buyerName %></td>
            <td>
              <ul>
                <% transaction.items.forEach(item => { %>
                <li>
                  <%= item.name %> (Rp <%= item.price %> x <%= item.quantity %>)
                </li>
                <% }) %>
              </ul>
            </td>
            <td>Rp <%= transaction.total %></td>
            <td><%= transaction.createdAt.toLocaleDateString() %></td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <script>
      // Fungsi untuk menambah input barang
      function addItem() {
        const itemsDiv = document.getElementById("items");
        const newItem = document.createElement("div");
        newItem.className = "item";
        newItem.innerHTML = `
        <input type="text" name="itemName" placeholder="Nama Barang" required>
        <input type="number" name="itemPrice" placeholder="Harga" step="0.01" required>
        <input type="number" name="itemQuantity" placeholder="Jumlah" required>
      `;
        itemsDiv.appendChild(newItem);
      }

      // Fungsi untuk mengumpulkan data barang sebelum submit
      document.querySelector("form").addEventListener("submit", function (e) {
        const items = [];
        document.querySelectorAll(".item").forEach((item) => {
          const name = item.querySelector('input[name="itemName"]').value;
          const price = parseFloat(
            item.querySelector('input[name="itemPrice"]').value
          );
          const quantity = parseInt(
            item.querySelector('input[name="itemQuantity"]').value
          );
          items.push({ name, price, quantity });
        });
        document.getElementById("itemsInput").value = JSON.stringify(items);
      });
    </script>
  </body>
</html>
